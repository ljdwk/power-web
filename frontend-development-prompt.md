# åŠŸç‡æ•°æ®æŸ¥è¯¢ç³»ç»Ÿå‰ç«¯å¼€å‘æç¤ºè¯

## é¡¹ç›®æ¦‚è¿°
åŸºäºPower APIæœåŠ¡å¼€å‘ä¸€ä¸ªç°ä»£åŒ–çš„ç§»åŠ¨ç«¯ä¼˜å…ˆçš„åŠŸç‡æ•°æ®å¯è§†åŒ–å‰ç«¯é¡µé¢ï¼Œç”¨äºæŸ¥è¯¢å’Œå±•ç¤ºå…‰ä¼ç”µç«™çš„å‘ç”µåŠŸç‡æ•°æ®ã€‚

## æŠ€æœ¯æ ˆè¦æ±‚
- **Vue 3** + **TypeScript** + **Vite** (æ¨è)
- **UIç»„ä»¶åº“**: Vant 4 (ç§»åŠ¨ç«¯ä¼˜åŒ–) æˆ– Element Plus
- **å›¾è¡¨åº“**: ECharts (Apache ECharts) - æ”¯æŒç§»åŠ¨ç«¯å’Œäº¤äº’
- **HTTPå®¢æˆ·ç«¯**: Axios
- **æ ·å¼**: SCSS + CSS Variables (æ”¯æŒæ·±è‰²æ¨¡å¼)
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯ä¼˜å…ˆï¼Œæ¡Œé¢ç«¯é€‚é…

## åç«¯APIæ¥å£æ–‡æ¡£

### åŸºç¡€é…ç½®
```
Base URL: http://localhost:8080
```

### 1. è·å–ç”µç«™åˆ—è¡¨
```http
GET /pv/stations
```

**å“åº”æ ¼å¼:**
```json
{
  "stations": [
    {"stationId": "200120121003"},
    {"stationId": "202511190000"},
    {"stationId": "202511190001"}
  ],
  "totalCount": 3
}
```

### 2. æŸ¥è¯¢åŠŸç‡æ•°æ®
```http
GET /pv/{stationId}/power?startTime={timestamp}&endTime={timestamp}
```

**è·¯å¾„å‚æ•°:**
- `stationId`: ç”µç«™ID (ä»ç”µç«™åˆ—è¡¨è·å–)

**æŸ¥è¯¢å‚æ•°:**
- `startTime`: å¼€å§‹æ—¶é—´æˆ³ (æ¯«ç§’)
- `endTime`: ç»“æŸæ—¶é—´æˆ³ (æ¯«ç§’)

**å“åº”æ ¼å¼:**
```json
{
  "stationId": "200120121003",
  "data": [
    {
      "deviceTime": "1763571633632", // æ—¶é—´æˆ³
      "gridPower": 63.5              // åŠŸç‡å€¼ (å•ä½: ç“¦ç‰¹)
    }
  ]
}
```

## é¡µé¢åŠŸèƒ½éœ€æ±‚

### 1. ç”µç«™é€‰æ‹©åŠŸèƒ½
- **ä¸‹æ‹‰é€‰æ‹©å™¨**: ä»APIåŠ¨æ€åŠ è½½ç”µç«™åˆ—è¡¨
- **é»˜è®¤é€‰ä¸­**: ç¬¬ä¸€ä¸ªç”µç«™
- **æ˜¾ç¤ºæ ¼å¼**: ç”µç«™ID (åæœŸå¯æ‰©å±•æ˜¾ç¤ºç”µç«™åç§°)
- **ä½ç½®**: é¡µé¢é¡¶éƒ¨ï¼Œçªå‡ºæ˜¾ç¤º

### 2. æ—¶é—´èŒƒå›´é€‰æ‹©åŠŸèƒ½
- **è‡ªå®šä¹‰æ—¶é—´é€‰æ‹©**:
  - å¼€å§‹æ—¶é—´é€‰æ‹©å™¨ (æ—¥æœŸ+æ—¶é—´)
  - ç»“æŸæ—¶é—´é€‰æ‹©å™¨ (æ—¥æœŸ+æ—¶é—´)
- **å¿«é€Ÿé€‰æ‹©æŒ‰é’®ç»„**:
  - ä»Šå¤© (00:00 - å½“å‰æ—¶é—´)
  - å‰3å¤© (72å°æ—¶å‰åˆ°ç°åœ¨)
  - å‰7å¤© (7å¤©å‰åˆ°ç°åœ¨)
- **æ—¶é—´é™åˆ¶**: æœ€å¤§æŸ¥è¯¢èŒƒå›´ä¸è¶…è¿‡30å¤©
- **ç§»åŠ¨ç«¯ä¼˜åŒ–**: ä½¿ç”¨åŸç”Ÿçš„datetime-localè¾“å…¥æ§ä»¶

### 3. æ•°æ®æŸ¥è¯¢åŠŸèƒ½
- **æŸ¥è¯¢æŒ‰é’®**: è§¦å‘APIè°ƒç”¨
- **åŠ è½½çŠ¶æ€**: æŸ¥è¯¢è¿‡ç¨‹ä¸­æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- **é”™è¯¯å¤„ç†**: ç½‘ç»œé”™è¯¯ã€æ— æ•°æ®ç­‰å‹å¥½æç¤º
- **é˜²æŠ–æœºåˆ¶**: é¿å…é¢‘ç¹è¯·æ±‚

### 4. æ•°æ®å¯è§†åŒ–åŠŸèƒ½
- **æ›²çº¿å›¾å±•ç¤º**: ä½¿ç”¨EChartsç»˜åˆ¶æ—¶é—´-åŠŸç‡æ›²çº¿
- **æ•°æ®å¤„ç†**:
  - å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºå¯è¯»æ—¶é—´æ ¼å¼
  - ç©ºæ•°æ®æ—¶é—´ç‚¹å¡«å……ä¸º0åŠŸç‡
  - æ—¶é—´é—´éš”ç»Ÿä¸€åŒ–å¤„ç†
- **å›¾è¡¨é…ç½®**:
  - Xè½´: æ—¶é—´æ ‡ç­¾ (æ ¼å¼: MM-DD HH:mm)
  - Yè½´: åŠŸç‡å€¼ (å•ä½: W)
  - ç½‘æ ¼çº¿ã€å·¥å…·ç®±ã€æ•°æ®ç¼©æ”¾
  - å“åº”å¼å¤§å°è°ƒæ•´

### 5. äº¤äº’åŠŸèƒ½
- **æ•°æ®ç‚¹æ‚¬åœ**: æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯æ°”æ³¡
  - æ—¶é—´: YYYY-MM-DD HH:mm:ss
  - åŠŸç‡: XX.X W
- **å›¾è¡¨ç¼©æ”¾**: æ”¯æŒè§¦æ‘¸ç¼©æ”¾å’Œæ‹–æ‹½
- **å›¾ä¾‹æ˜¾ç¤º**: åŠŸç‡æ›²çº¿å›¾ä¾‹

### 6. ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
- **æœ€å¤§åŠŸç‡**: æŸ¥è¯¢æ—¶é—´æ®µå†…çš„æœ€å¤§åŠŸç‡å€¼
- **æœ€å°åŠŸç‡**: æŸ¥è¯¢æ—¶é—´æ®µå†…çš„æœ€å°åŠŸç‡å€¼
- **å¹³å‡åŠŸç‡**: å¯é€‰æ˜¾ç¤ºå¹³å‡åŠŸç‡
- **æ•°æ®ç‚¹æ•°é‡**: æ€»æ•°æ®ç‚¹ç»Ÿè®¡

## ç•Œé¢è®¾è®¡è¦æ±‚

### 1. ç§»åŠ¨ç«¯ä¼˜å…ˆè®¾è®¡
- **è§†å£è®¾ç½®**: `<meta name="viewport" content="width=device-width, initial-scale=1.0">`
- **å“åº”å¼æ–­ç‚¹**:
  - æ‰‹æœº: < 768px
  - å¹³æ¿: 768px - 1024px
  - æ¡Œé¢: > 1024px

### 2. ç°ä»£åŒ–è§†è§‰é£æ ¼
- **è‰²å½©æ–¹æ¡ˆ**:
  - ä¸»è‰²è°ƒ: è“è‰²ç³» (#1890ff, #40a9ff)
  - èƒŒæ™¯è‰²: #f5f7fa (æµ…ç°)
  - å¡ç‰‡èƒŒæ™¯: #ffffff (çº¯ç™½)
  - æ–‡å­—è‰²: #333333 (æ·±ç°)
  - è¾¹æ¡†è‰²: #e8e8e8 (æµ…ç°è¾¹æ¡†)
- **åœ†è§’è®¾è®¡**: 8px-16pxåœ†è§’
- **é˜´å½±æ•ˆæœ**: è½»å¾®å¡ç‰‡é˜´å½± (box-shadow)
- **é—´è·è§„èŒƒ**: 16pxåŸºç¡€é—´è·å•ä½

### 3. ç»„ä»¶å¸ƒå±€è®¾è®¡
```
é¡µé¢ç»“æ„ (ç§»åŠ¨ç«¯):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ  ç”µç«™é€‰æ‹©ä¸‹æ‹‰æ¡†        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… æ—¶é—´é€‰æ‹©åŒºåŸŸ              â”‚
â”‚  [å¼€å§‹æ—¶é—´] - [ç»“æŸæ—¶é—´]      â”‚
â”‚  [ä»Šå¤©] [å‰3å¤©] [å‰7å¤©] [æŸ¥è¯¢] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡              â”‚
â”‚  æœ€å¤§åŠŸç‡: XXX.X W           â”‚
â”‚  æœ€å°åŠŸç‡: XXX.X W           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š åŠŸç‡æ›²çº¿å›¾                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      ECharts å›¾è¡¨       â”‚ â”‚
â”‚  â”‚                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. æš—é»‘æ¨¡å¼æ”¯æŒ
- ä½¿ç”¨CSS Variableså®ç°ä¸»é¢˜åˆ‡æ¢
- æ·±è‰²èƒŒæ™¯: #1a1a1a
- æ·±è‰²å¡ç‰‡: #2a2a2a
- æ·±è‰²æ–‡å­—: #ffffff

## æŠ€æœ¯å®ç°è¦ç‚¹

### 1. æ—¶é—´å¤„ç†å·¥å…·å‡½æ•°
```typescript
// æ—¶é—´æˆ³è½¬æ¢
function formatTimestamp(timestamp: number): string {
  return new Date(timestamp).toLocaleString();
}

// è·å–å¿«é€Ÿé€‰æ‹©æ—¶é—´èŒƒå›´
function getQuickRange(type: 'today' | '3days' | '7days') {
  const now = new Date();
  const start = new Date();

  switch(type) {
    case 'today':
      start.setHours(0, 0, 0, 0);
      break;
    case '3days':
      start.setDate(now.getDate() - 3);
      break;
    case '7days':
      start.setDate(now.getDate() - 7);
      break;
  }

  return {
    start: start.getTime(),
    end: now.getTime()
  };
}
```

### 2. å›¾è¡¨é…ç½® (ECharts)
```typescript
const chartOptions = {
  title: {
    text: 'åŠŸç‡æ›²çº¿',
    left: 'center',
    textStyle: { fontSize: 16 }
  },
  tooltip: {
    trigger: 'axis',
    formatter: function(params: any) {
      const data = params[0];
      return `æ—¶é—´: ${formatTimestamp(data.axisValue)}<br/>åŠŸç‡: ${data.value} W`;
    }
  },
  xAxis: {
    type: 'time',
    axisLabel: { format: '{MM}-{dd} {HH}:{mm}' }
  },
  yAxis: {
    type: 'value',
    name: 'åŠŸç‡ (W)',
    axisLabel: { formatter: '{value} W' }
  },
  series: [{
    type: 'line',
    smooth: true,
    symbol: 'circle',
    symbolSize: 6,
    lineStyle: { width: 2 },
    itemStyle: { color: '#1890ff' }
  }]
};
```

### 3. APIæœåŠ¡å°è£…
```typescript
class PowerApiService {
  private baseUrl = 'http://localhost:8080';

  async getStations(): Promise<StationListResponse> {
    const response = await axios.get(`${this.baseUrl}/pv/stations`);
    return response.data;
  }

  async getPowerData(stationId: string, startTime: number, endTime: number): Promise<PowerDataResponse> {
    const response = await axios.get(
      `${this.baseUrl}/pv/${stationId}/power`,
      { params: { startTime, endTime } }
    );
    return response.data;
  }
}
```

### 4. æ•°æ®å¤„ç†é€»è¾‘
```typescript
function processChartData(data: PowerData[]): ChartPoint[] {
  if (!data || data.length === 0) return [];

  // æ’åºå¹¶å¡«å……ç©ºæ•°æ®
  const sorted = data.sort((a, b) =>
    parseInt(a.deviceTime) - parseInt(b.deviceTime)
  );

  // å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºæ•°å­—ï¼Œå¡«å……ç©ºéš™
  const points: ChartPoint[] = [];
  const interval = 60000; // 1åˆ†é’Ÿé—´éš”

  for (let time = sorted[0].deviceTime; time <= sorted[sorted.length - 1].deviceTime; time += interval) {
    const point = sorted.find(p => Math.abs(parseInt(p.deviceTime) - time) < interval/2);
    points.push({
      time: parseInt(time),
      value: point ? parseFloat(point.gridPower) : 0
    });
  }

  return points;
}
```

## å¼€å‘æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½ä¼˜åŒ–
- **è™šæ‹Ÿæ»šåŠ¨**: å¤§é‡æ•°æ®æ—¶ä½¿ç”¨å›¾è¡¨æ•°æ®ç¼©æ”¾
- **é˜²æŠ–å¤„ç†**: æŸ¥è¯¢æŒ‰é’®é˜²æŠ–ï¼Œé¿å…é‡å¤è¯·æ±‚
- **ç¼“å­˜ç­–ç•¥**: ç”µç«™åˆ—è¡¨å¯ç¼“å­˜ï¼ŒåŠŸç‡æ•°æ®æŒ‰æ—¶é—´èŒƒå›´ç¼“å­˜

### 2. é”™è¯¯å¤„ç†
- **ç½‘ç»œé”™è¯¯**: æ˜¾ç¤ºé‡è¯•æŒ‰é’®
- **ç©ºæ•°æ®å¤„ç†**: æ˜¾ç¤ºå‹å¥½çš„æ— æ•°æ®æç¤º
- **æ—¶é—´èŒƒå›´éªŒè¯**: å¼€å§‹æ—¶é—´ä¸èƒ½æ™šäºç»“æŸæ—¶é—´

### 3. ç”¨æˆ·ä½“éªŒ
- **åŠ è½½çŠ¶æ€**: æŸ¥è¯¢æ—¶æ˜¾ç¤ºskeleton loading
- **ä¸‹æ‹‰åˆ·æ–°**: ç§»åŠ¨ç«¯æ”¯æŒä¸‹æ‹‰åˆ·æ–°
- **ç¦»çº¿æç¤º**: ç½‘ç»œæ–­å¼€æ—¶æ˜¾ç¤ºç¦»çº¿çŠ¶æ€

### 4. æµè§ˆå™¨å…¼å®¹æ€§
- **ç°ä»£æµè§ˆå™¨**: æ”¯æŒES2020+ç‰¹æ€§
- **iOS Safari**: 14+ç‰ˆæœ¬æ”¯æŒ
- **Android Chrome**: 90+ç‰ˆæœ¬æ”¯æŒ

## éƒ¨ç½²è¦æ±‚
- **é™æ€æ–‡ä»¶æ‰˜ç®¡**: å¯éƒ¨ç½²åˆ°Nginxã€CDNç­‰é™æ€æœåŠ¡å™¨
- **è·¨åŸŸå¤„ç†**: å¦‚éœ€è¦å¯é…ç½®ä»£ç†æˆ–CORS
- **HTTPSæ”¯æŒ**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨HTTPSåè®®
- **PWAæ”¯æŒ**: å¯æ‰©å±•ä¸ºæ¸è¿›å¼Webåº”ç”¨

è¿™ä»½æç¤ºè¯æ¶µç›–äº†å®Œæ•´çš„å‰ç«¯å¼€å‘éœ€æ±‚ï¼ŒåŒ…æ‹¬æŠ€æœ¯é€‰å‹ã€APIå¯¹æ¥ã€ç•Œé¢è®¾è®¡å’Œå…·ä½“å®ç°ç»†èŠ‚ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘å¿«é€Ÿæ„å»ºä¸€ä¸ªç°ä»£åŒ–çš„åŠŸç‡æ•°æ®æŸ¥è¯¢ç³»ç»Ÿã€‚